#!/bin/bash

# Diligence Agent CLI wrapper
# Makes it easier to run the diligence agent with various options

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if virtual environment exists
if [ ! -d ".venv" ]; then
    echo -e "${YELLOW}Virtual environment not found. Setting up...${NC}"
    uv sync
fi

# Function to display help
show_help() {
    echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo -e "${BLUE}         DILIGENCE AGENT - Investment Analysis Tool${NC}"
    echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""
    echo "Usage:"
    echo "  ./diligence                    # Interactive mode - pick from menu"
    echo "  ./diligence list               # List available companies"
    echo "  ./diligence <company>          # Analyze specific company"
    echo "  ./diligence <company1> <company2> # Analyze multiple companies"
    echo "  ./diligence all                # Analyze all companies"
    echo ""
    echo "Examples:"
    echo "  ./diligence                    # Opens interactive menu"
    echo "  ./diligence list               # Shows: tensorstax, baseten"
    echo "  ./diligence tensorstax         # Analyzes Tensorstax only"
    echo "  ./diligence tensorstax baseten # Analyzes both companies"
    echo "  ./diligence all                # Analyzes all available companies"
    echo ""
    echo "Options:"
    echo "  -h, --help                     # Show this help message"
    echo "  -l, --list                     # List available companies"
    echo "  -i, --interactive              # Force interactive mode"
    echo ""
}

# Handle help flag
if [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]] || [[ "$1" == "help" ]]; then
    show_help
    exit 0
fi

# Handle list command
if [[ "$1" == "list" ]] || [[ "$1" == "-l" ]] || [[ "$1" == "--list" ]]; then
    echo -e "${BLUE}Available companies:${NC}"
    uv run -q python -m diligence_agent --list 2>/dev/null
    exit 0
fi

# Handle 'all' command
if [[ "$1" == "all" ]]; then
    echo -e "${GREEN}Analyzing all companies...${NC}"
    uv run -q python -m diligence_agent --all 2>/dev/null
    exit 0
fi

# Set environment to suppress warnings
export PYTHONWARNINGS="ignore"
export PYTHONDONTWRITEBYTECODE=1

# Run with arguments or interactive
if [ $# -eq 0 ]; then
    # No arguments - run interactive mode
    echo -e "${BLUE}Starting interactive mode...${NC}"
    echo ""
    # Use the package directly (will use __main__.py) and filter warnings
    uv run python -m diligence_agent 2>&1 | grep -v "/site-packages/"
else
    # Pass all arguments to the Python script
    echo -e "${GREEN}Analyzing: $@${NC}"
    echo ""
    # For command-line args, use the package directly and filter warnings
    uv run python -m diligence_agent "$@" 2>&1 | grep -v "/site-packages/"
fi